{"ast":null,"code":"import loader from '@monaco-editor/loader';\nimport React, { useState, useRef, useCallback, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport MonacoContainer from '../MonacoContainer/index.js';\nimport useMount from '../hooks/useMount/index.js';\nimport useUpdate from '../hooks/useUpdate/index.js';\nimport { getOrCreateModel, noop, isUndefined } from '../utils/index.js';\nimport state from 'state-local';\nimport usePrevious from '../hooks/usePrevious/index.js';\nconst [getModelMarkersSetter, setModelMarkersSetter] = state.create({\n  backup: null\n});\nconst viewStates = new Map();\n\nfunction Editor({\n  defaultValue,\n  defaultLanguage,\n  defaultPath,\n  value,\n  language,\n  path,\n\n  /* === */\n  theme,\n  line,\n  loading,\n  options,\n  overrideServices,\n  saveViewState,\n  keepCurrentModel,\n\n  /* === */\n  width,\n  height,\n  className,\n  wrapperClassName,\n\n  /* === */\n  beforeMount,\n  onMount,\n  onChange,\n  onValidate\n}) {\n  const [isEditorReady, setIsEditorReady] = useState(false);\n  const [isMonacoMounting, setIsMonacoMounting] = useState(true);\n  const monacoRef = useRef(null);\n  const editorRef = useRef(null);\n  const containerRef = useRef(null);\n  const onMountRef = useRef(onMount);\n  const beforeMountRef = useRef(beforeMount);\n  const subscriptionRef = useRef(null);\n  const valueRef = useRef(value);\n  const previousPath = usePrevious(path);\n  useMount(() => {\n    const cancelable = loader.init();\n    cancelable.then(monaco => (monacoRef.current = monaco) && setIsMonacoMounting(false)).catch(error => (error === null || error === void 0 ? void 0 : error.type) !== 'cancelation' && console.error('Monaco initialization: error:', error));\n    return () => editorRef.current ? disposeEditor() : cancelable.cancel();\n  });\n  useUpdate(() => {\n    const model = getOrCreateModel(monacoRef.current, defaultValue || value, defaultLanguage || language, path);\n\n    if (model !== editorRef.current.getModel()) {\n      saveViewState && viewStates.set(previousPath, editorRef.current.saveViewState());\n      editorRef.current.setModel(model);\n      saveViewState && editorRef.current.restoreViewState(viewStates.get(path));\n    }\n  }, [path], isEditorReady);\n  useUpdate(() => {\n    editorRef.current.updateOptions(options);\n  }, [options], isEditorReady);\n  useUpdate(() => {\n    if (editorRef.current.getOption(monacoRef.current.editor.EditorOption.readOnly)) {\n      editorRef.current.setValue(value);\n    } else {\n      if (value !== editorRef.current.getValue()) {\n        editorRef.current.executeEdits('', [{\n          range: editorRef.current.getModel().getFullModelRange(),\n          text: value,\n          forceMoveMarkers: true\n        }]);\n        editorRef.current.pushUndoStop();\n      }\n    }\n  }, [value], isEditorReady);\n  useUpdate(() => {\n    monacoRef.current.editor.setModelLanguage(editorRef.current.getModel(), language);\n  }, [language], isEditorReady);\n  useUpdate(() => {\n    // reason for undefined check: https://github.com/suren-atoyan/monaco-react/pull/188\n    if (!isUndefined(line)) {\n      editorRef.current.revealLine(line);\n    }\n  }, [line], isEditorReady);\n  useUpdate(() => {\n    monacoRef.current.editor.setTheme(theme);\n  }, [theme], isEditorReady);\n  const createEditor = useCallback(() => {\n    beforeMountRef.current(monacoRef.current);\n    const autoCreatedModelPath = path || defaultPath;\n    const defaultModel = getOrCreateModel(monacoRef.current, value || defaultValue, defaultLanguage || language, autoCreatedModelPath);\n    editorRef.current = monacoRef.current.editor.create(containerRef.current, {\n      model: defaultModel,\n      automaticLayout: true,\n      ...options\n    }, overrideServices);\n    saveViewState && editorRef.current.restoreViewState(viewStates.get(autoCreatedModelPath));\n    monacoRef.current.editor.setTheme(theme);\n\n    if (!getModelMarkersSetter().backup) {\n      setModelMarkersSetter({\n        backup: monacoRef.current.editor.setModelMarkers\n      });\n    }\n\n    setIsEditorReady(true);\n  }, [defaultValue, defaultLanguage, defaultPath, value, language, path, options, overrideServices, saveViewState, theme]);\n  useEffect(() => {\n    if (isEditorReady) {\n      onMountRef.current(editorRef.current, monacoRef.current);\n    }\n  }, [isEditorReady]);\n  useEffect(() => {\n    !isMonacoMounting && !isEditorReady && createEditor();\n  }, [isMonacoMounting, isEditorReady, createEditor]); // subscription\n  // to avoid unnecessary updates (attach - dispose listener) in subscription\n\n  valueRef.current = value;\n  useEffect(() => {\n    if (isEditorReady && onChange) {\n      var _subscriptionRef$curr, _editorRef$current;\n\n      (_subscriptionRef$curr = subscriptionRef.current) === null || _subscriptionRef$curr === void 0 ? void 0 : _subscriptionRef$curr.dispose();\n      subscriptionRef.current = (_editorRef$current = editorRef.current) === null || _editorRef$current === void 0 ? void 0 : _editorRef$current.onDidChangeModelContent(event => {\n        const editorValue = editorRef.current.getValue();\n\n        if (valueRef.current !== editorValue) {\n          onChange(editorValue, event);\n        }\n      });\n    }\n  }, [isEditorReady, onChange]); // onValidate\n\n  useEffect(() => {\n    if (isEditorReady) {\n      monacoRef.current.editor.setModelMarkers = function (model, owner, markers) {\n        var _getModelMarkersSette;\n\n        (_getModelMarkersSette = getModelMarkersSetter().backup) === null || _getModelMarkersSette === void 0 ? void 0 : _getModelMarkersSette.call(monacoRef.current.editor, model, owner, markers);\n        onValidate === null || onValidate === void 0 ? void 0 : onValidate(markers);\n      };\n    }\n  }, [isEditorReady, onValidate]);\n\n  function disposeEditor() {\n    var _subscriptionRef$curr2;\n\n    (_subscriptionRef$curr2 = subscriptionRef.current) === null || _subscriptionRef$curr2 === void 0 ? void 0 : _subscriptionRef$curr2.dispose();\n\n    if (keepCurrentModel) {\n      saveViewState && viewStates.set(path, editorRef.current.saveViewState());\n    } else {\n      var _editorRef$current$ge;\n\n      (_editorRef$current$ge = editorRef.current.getModel()) === null || _editorRef$current$ge === void 0 ? void 0 : _editorRef$current$ge.dispose();\n    }\n\n    editorRef.current.dispose();\n  }\n\n  return /*#__PURE__*/React.createElement(MonacoContainer, {\n    width: width,\n    height: height,\n    isEditorReady: isEditorReady,\n    loading: loading,\n    _ref: containerRef,\n    className: className,\n    wrapperClassName: wrapperClassName\n  });\n}\n\nEditor.propTypes = {\n  defaultValue: PropTypes.string,\n  defaultPath: PropTypes.string,\n  defaultLanguage: PropTypes.string,\n  value: PropTypes.string,\n  language: PropTypes.string,\n  path: PropTypes.string,\n\n  /* === */\n  theme: PropTypes.string,\n  line: PropTypes.number,\n  loading: PropTypes.oneOfType([PropTypes.element, PropTypes.string]),\n  options: PropTypes.object,\n  overrideServices: PropTypes.object,\n  saveViewState: PropTypes.bool,\n  keepCurrentModel: PropTypes.bool,\n\n  /* === */\n  width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  className: PropTypes.string,\n  wrapperClassName: PropTypes.string,\n\n  /* === */\n  beforeMount: PropTypes.func,\n  onMount: PropTypes.func,\n  onChange: PropTypes.func,\n  onValidate: PropTypes.func\n};\nEditor.defaultProps = {\n  theme: 'light',\n  loading: 'Loading...',\n  options: {},\n  overrideServices: {},\n  saveViewState: true,\n  keepCurrentModel: false,\n\n  /* === */\n  width: '100%',\n  height: '100%',\n\n  /* === */\n  beforeMount: noop,\n  onMount: noop,\n  onValidate: noop\n};\nexport default Editor;","map":{"version":3,"sources":["/home/imane/Documents/M1/S2/Projet annuel/frontend/node_modules/@monaco-editor/react/lib/es/Editor/Editor.js"],"names":["loader","React","useState","useRef","useCallback","useEffect","PropTypes","MonacoContainer","useMount","useUpdate","getOrCreateModel","noop","isUndefined","state","usePrevious","getModelMarkersSetter","setModelMarkersSetter","create","backup","viewStates","Map","Editor","defaultValue","defaultLanguage","defaultPath","value","language","path","theme","line","loading","options","overrideServices","saveViewState","keepCurrentModel","width","height","className","wrapperClassName","beforeMount","onMount","onChange","onValidate","isEditorReady","setIsEditorReady","isMonacoMounting","setIsMonacoMounting","monacoRef","editorRef","containerRef","onMountRef","beforeMountRef","subscriptionRef","valueRef","previousPath","cancelable","init","then","monaco","current","catch","error","type","console","disposeEditor","cancel","model","getModel","set","setModel","restoreViewState","get","updateOptions","getOption","editor","EditorOption","readOnly","setValue","getValue","executeEdits","range","getFullModelRange","text","forceMoveMarkers","pushUndoStop","setModelLanguage","revealLine","setTheme","createEditor","autoCreatedModelPath","defaultModel","automaticLayout","setModelMarkers","_subscriptionRef$curr","_editorRef$current","dispose","onDidChangeModelContent","event","editorValue","owner","markers","_getModelMarkersSette","call","_subscriptionRef$curr2","_editorRef$current$ge","createElement","_ref","propTypes","string","number","oneOfType","element","object","bool","func","defaultProps"],"mappings":"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","sourcesContent":["import loader from '@monaco-editor/loader';\nimport React, { useState, useRef, useCallback, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport MonacoContainer from '../MonacoContainer/index.js';\nimport useMount from '../hooks/useMount/index.js';\nimport useUpdate from '../hooks/useUpdate/index.js';\nimport { getOrCreateModel, noop, isUndefined } from '../utils/index.js';\nimport state from 'state-local';\nimport usePrevious from '../hooks/usePrevious/index.js';\n\nconst [getModelMarkersSetter, setModelMarkersSetter] = state.create({\n  backup: null\n});\nconst viewStates = new Map();\n\nfunction Editor({\n  defaultValue,\n  defaultLanguage,\n  defaultPath,\n  value,\n  language,\n  path,\n\n  /* === */\n  theme,\n  line,\n  loading,\n  options,\n  overrideServices,\n  saveViewState,\n  keepCurrentModel,\n\n  /* === */\n  width,\n  height,\n  className,\n  wrapperClassName,\n\n  /* === */\n  beforeMount,\n  onMount,\n  onChange,\n  onValidate\n}) {\n  const [isEditorReady, setIsEditorReady] = useState(false);\n  const [isMonacoMounting, setIsMonacoMounting] = useState(true);\n  const monacoRef = useRef(null);\n  const editorRef = useRef(null);\n  const containerRef = useRef(null);\n  const onMountRef = useRef(onMount);\n  const beforeMountRef = useRef(beforeMount);\n  const subscriptionRef = useRef(null);\n  const valueRef = useRef(value);\n  const previousPath = usePrevious(path);\n  useMount(() => {\n    const cancelable = loader.init();\n    cancelable.then(monaco => (monacoRef.current = monaco) && setIsMonacoMounting(false)).catch(error => (error === null || error === void 0 ? void 0 : error.type) !== 'cancelation' && console.error('Monaco initialization: error:', error));\n    return () => editorRef.current ? disposeEditor() : cancelable.cancel();\n  });\n  useUpdate(() => {\n    const model = getOrCreateModel(monacoRef.current, defaultValue || value, defaultLanguage || language, path);\n\n    if (model !== editorRef.current.getModel()) {\n      saveViewState && viewStates.set(previousPath, editorRef.current.saveViewState());\n      editorRef.current.setModel(model);\n      saveViewState && editorRef.current.restoreViewState(viewStates.get(path));\n    }\n  }, [path], isEditorReady);\n  useUpdate(() => {\n    editorRef.current.updateOptions(options);\n  }, [options], isEditorReady);\n  useUpdate(() => {\n    if (editorRef.current.getOption(monacoRef.current.editor.EditorOption.readOnly)) {\n      editorRef.current.setValue(value);\n    } else {\n      if (value !== editorRef.current.getValue()) {\n        editorRef.current.executeEdits('', [{\n          range: editorRef.current.getModel().getFullModelRange(),\n          text: value,\n          forceMoveMarkers: true\n        }]);\n        editorRef.current.pushUndoStop();\n      }\n    }\n  }, [value], isEditorReady);\n  useUpdate(() => {\n    monacoRef.current.editor.setModelLanguage(editorRef.current.getModel(), language);\n  }, [language], isEditorReady);\n  useUpdate(() => {\n    // reason for undefined check: https://github.com/suren-atoyan/monaco-react/pull/188\n    if (!isUndefined(line)) {\n      editorRef.current.revealLine(line);\n    }\n  }, [line], isEditorReady);\n  useUpdate(() => {\n    monacoRef.current.editor.setTheme(theme);\n  }, [theme], isEditorReady);\n  const createEditor = useCallback(() => {\n    beforeMountRef.current(monacoRef.current);\n    const autoCreatedModelPath = path || defaultPath;\n    const defaultModel = getOrCreateModel(monacoRef.current, value || defaultValue, defaultLanguage || language, autoCreatedModelPath);\n    editorRef.current = monacoRef.current.editor.create(containerRef.current, {\n      model: defaultModel,\n      automaticLayout: true,\n      ...options\n    }, overrideServices);\n    saveViewState && editorRef.current.restoreViewState(viewStates.get(autoCreatedModelPath));\n    monacoRef.current.editor.setTheme(theme);\n\n    if (!getModelMarkersSetter().backup) {\n      setModelMarkersSetter({\n        backup: monacoRef.current.editor.setModelMarkers\n      });\n    }\n\n    setIsEditorReady(true);\n  }, [defaultValue, defaultLanguage, defaultPath, value, language, path, options, overrideServices, saveViewState, theme]);\n  useEffect(() => {\n    if (isEditorReady) {\n      onMountRef.current(editorRef.current, monacoRef.current);\n    }\n  }, [isEditorReady]);\n  useEffect(() => {\n    !isMonacoMounting && !isEditorReady && createEditor();\n  }, [isMonacoMounting, isEditorReady, createEditor]); // subscription\n  // to avoid unnecessary updates (attach - dispose listener) in subscription\n\n  valueRef.current = value;\n  useEffect(() => {\n    if (isEditorReady && onChange) {\n      var _subscriptionRef$curr, _editorRef$current;\n\n      (_subscriptionRef$curr = subscriptionRef.current) === null || _subscriptionRef$curr === void 0 ? void 0 : _subscriptionRef$curr.dispose();\n      subscriptionRef.current = (_editorRef$current = editorRef.current) === null || _editorRef$current === void 0 ? void 0 : _editorRef$current.onDidChangeModelContent(event => {\n        const editorValue = editorRef.current.getValue();\n\n        if (valueRef.current !== editorValue) {\n          onChange(editorValue, event);\n        }\n      });\n    }\n  }, [isEditorReady, onChange]); // onValidate\n\n  useEffect(() => {\n    if (isEditorReady) {\n      monacoRef.current.editor.setModelMarkers = function (model, owner, markers) {\n        var _getModelMarkersSette;\n\n        (_getModelMarkersSette = getModelMarkersSetter().backup) === null || _getModelMarkersSette === void 0 ? void 0 : _getModelMarkersSette.call(monacoRef.current.editor, model, owner, markers);\n        onValidate === null || onValidate === void 0 ? void 0 : onValidate(markers);\n      };\n    }\n  }, [isEditorReady, onValidate]);\n\n  function disposeEditor() {\n    var _subscriptionRef$curr2;\n\n    (_subscriptionRef$curr2 = subscriptionRef.current) === null || _subscriptionRef$curr2 === void 0 ? void 0 : _subscriptionRef$curr2.dispose();\n\n    if (keepCurrentModel) {\n      saveViewState && viewStates.set(path, editorRef.current.saveViewState());\n    } else {\n      var _editorRef$current$ge;\n\n      (_editorRef$current$ge = editorRef.current.getModel()) === null || _editorRef$current$ge === void 0 ? void 0 : _editorRef$current$ge.dispose();\n    }\n\n    editorRef.current.dispose();\n  }\n\n  return /*#__PURE__*/React.createElement(MonacoContainer, {\n    width: width,\n    height: height,\n    isEditorReady: isEditorReady,\n    loading: loading,\n    _ref: containerRef,\n    className: className,\n    wrapperClassName: wrapperClassName\n  });\n}\n\nEditor.propTypes = {\n  defaultValue: PropTypes.string,\n  defaultPath: PropTypes.string,\n  defaultLanguage: PropTypes.string,\n  value: PropTypes.string,\n  language: PropTypes.string,\n  path: PropTypes.string,\n\n  /* === */\n  theme: PropTypes.string,\n  line: PropTypes.number,\n  loading: PropTypes.oneOfType([PropTypes.element, PropTypes.string]),\n  options: PropTypes.object,\n  overrideServices: PropTypes.object,\n  saveViewState: PropTypes.bool,\n  keepCurrentModel: PropTypes.bool,\n\n  /* === */\n  width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  className: PropTypes.string,\n  wrapperClassName: PropTypes.string,\n\n  /* === */\n  beforeMount: PropTypes.func,\n  onMount: PropTypes.func,\n  onChange: PropTypes.func,\n  onValidate: PropTypes.func\n};\nEditor.defaultProps = {\n  theme: 'light',\n  loading: 'Loading...',\n  options: {},\n  overrideServices: {},\n  saveViewState: true,\n  keepCurrentModel: false,\n\n  /* === */\n  width: '100%',\n  height: '100%',\n\n  /* === */\n  beforeMount: noop,\n  onMount: noop,\n  onValidate: noop\n};\n\nexport default Editor;\n"]},"metadata":{},"sourceType":"module"}